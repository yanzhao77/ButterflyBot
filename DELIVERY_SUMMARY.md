# ButterflyBot äº¤ä»˜æ€»ç»“

**ä»»åŠ¡å®Œæˆæ—¶é—´**: 2025-12-23  
**GitHubä»“åº“**: https://github.com/yanzhao77/ButterflyBot  
**æœ€æ–°æäº¤**: 99499ba

---

## ğŸ¯ ä»»åŠ¡ç›®æ ‡

å®ç°åŸºäºæŒä»“çš„å–å‡ºé€»è¾‘ï¼Œä½¿ButterflyBotèƒ½å¤Ÿäº§ç”Ÿå®Œæ•´çš„ä¹°å–äº¤æ˜“å¾ªç¯ï¼Œä»è€Œèƒ½å¤Ÿè¯„ä¼°ç­–ç•¥æ€§èƒ½ã€‚

---

## âœ… å®Œæˆæƒ…å†µ

### æ ¸å¿ƒæˆå°±

| æŒ‡æ ‡ | ä¿®æ”¹å‰ | ä¿®æ”¹å | çŠ¶æ€ |
|------|--------|--------|------|
| æ€»äº¤æ˜“æ¬¡æ•° | **0** | **19** | âœ… æˆåŠŸ |
| ä¹°å–å¾ªç¯ | âŒ æ—  | âœ… å®Œæ•´ | âœ… æˆåŠŸ |
| æŒä»“çŠ¶æ€è·Ÿè¸ª | âŒ æ—  | âœ… æœ‰ | âœ… æˆåŠŸ |
| æ­¢ç›ˆæ­¢æŸæœºåˆ¶ | âŒ æ—  | âœ… æœ‰ | âœ… æˆåŠŸ |
| ç³»ç»Ÿå¯è¯„ä¼°æ€§ | âŒ æ— æ³•è¯„ä¼° | âœ… å¯è¯„ä¼° | âœ… æˆåŠŸ |

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### 1. butterfly_bot/strategies/ai_signal_core.py
**ä¿®æ”¹ç±»å‹**: æ ¸å¿ƒé€»è¾‘é‡æ„

**æ–°å¢å†…å®¹**:
```python
# æŒä»“çŠ¶æ€è·Ÿè¸ª
self.has_position = False
self.entry_price: Optional[float] = None
self.holding_bars = 0
self.position_bar = -1

# æ­¢ç›ˆæ­¢æŸå‚æ•°
self.take_profit_pct = 6.0   # æ­¢ç›ˆ6%
self.stop_loss_pct = 3.0     # æ­¢æŸ-3%
self.max_holding_bars = 50   # æ—¶é—´æ­¢æŸ50æ ¹Kçº¿
```

**æ–°å¢æ–¹æ³•**:
- `update_position_status(has_position, entry_price)`: æ›´æ–°æŒä»“çŠ¶æ€
- é‡æ„ `get_signal()`: æ·»åŠ æŒä»“æ£€æŸ¥å’Œ4ç§å–å‡ºæ¡ä»¶

**å–å‡ºé€»è¾‘ä¼˜å…ˆçº§**:
1. ğŸ¯ **æ­¢ç›ˆ**: ç›ˆåˆ© >= 6.0%
2. ğŸ›‘ **æ­¢æŸ**: äºæŸ >= 3.0%
3. â° **æ—¶é—´æ­¢æŸ**: æŒä»“ >= 50æ ¹Kçº¿
4. ğŸ“‰ **AIçœ‹è·Œ**: p_ema <= 0.45

**å…³é”®ä»£ç **:
```python
def get_signal(self, data: pd.DataFrame) -> Dict[str, Any]:
    # ä¼˜å…ˆæ£€æŸ¥æŒä»“çŠ¶æ€
    if self.has_position:
        self.holding_bars += 1
        current_price = data.iloc[-1]["close"]
        current_profit_pct = (current_price - self.entry_price) / self.entry_price * 100
        
        # 1. æ­¢ç›ˆæ£€æŸ¥
        if current_profit_pct >= self.take_profit_pct:
            return self._generate_sell_signal(...)
        
        # 2. æ­¢æŸæ£€æŸ¥
        if current_profit_pct <= -self.stop_loss_pct:
            return self._generate_sell_signal(...)
        
        # 3. æ—¶é—´æ­¢æŸ
        if self.holding_bars >= self.max_holding_bars:
            return self._generate_sell_signal(...)
        
        # 4. AIçœ‹è·Œ
        if p_ema <= SELL_THRESHOLD:
            return self._generate_sell_signal(...)
    
    # æ— æŒä»“æ—¶æ£€æŸ¥ä¹°å…¥æ¡ä»¶
    else:
        if p_ema >= self.confidence_threshold:
            return self._generate_buy_signal(...)
```

---

### 2. butterfly_bot/core/engine/trading_engine.py
**ä¿®æ”¹ç±»å‹**: å‚æ•°æ‰©å±• + çŠ¶æ€åŒæ­¥

**ä¿®æ”¹å†…å®¹**:
```python
# ä¿®æ”¹__init__æ–¹æ³•ç­¾å
def __init__(self, broker, risk_manager, symbol: str, get_signal_func: Callable, strategy=None):
    self.strategy = strategy  # æ–°å¢ï¼šä¿å­˜strategyå¼•ç”¨

# ä¹°å…¥æˆåŠŸåæ›´æ–°ç­–ç•¥çŠ¶æ€
if order:
    logger.info(f"ä¹°å…¥æˆåŠŸ: è®¢å•ID={order.get('order_id', 'N/A')}")
    if hasattr(self.strategy, 'update_position_status'):
        self.strategy.update_position_status(True, current_price)
        logger.debug(f"ğŸ“ å·²æ›´æ–°ç­–ç•¥æŒä»“çŠ¶æ€: å¼€ä»“ä»·æ ¼={current_price:.5f}")

# å–å‡ºæˆåŠŸåæ›´æ–°ç­–ç•¥çŠ¶æ€
if success:
    logger.info("å–å‡ºå¹³ä»“æˆåŠŸ")
    if hasattr(self.strategy, 'update_position_status'):
        self.strategy.update_position_status(False)
        logger.debug(f"ğŸ“ å·²æ›´æ–°ç­–ç•¥æŒä»“çŠ¶æ€: å¹³ä»“")
```

---

### 3. scripts/test_backtest.py
**ä¿®æ”¹ç±»å‹**: å‚æ•°ä¼ é€’

**ä¿®æ”¹å†…å®¹**:
```python
# ä¿®æ”¹å‰
engine = TradingEngine(broker, risk_manager, symbol, strategy.get_signal)

# ä¿®æ”¹å
engine = TradingEngine(broker, risk_manager, symbol, strategy.get_signal, strategy)
```

---

### 4. BACKTEST_RESULTS_ANALYSIS.md
**æ–‡ä»¶ç±»å‹**: æ–°å¢åˆ†ææŠ¥å‘Š

**å†…å®¹**: è¯¦ç»†çš„å›æµ‹ç»“æœåˆ†æå’Œä¼˜åŒ–å»ºè®®ï¼ˆè§è¯¥æ–‡ä»¶ï¼‰

---

## ğŸ“Š å›æµ‹ç»“æœ

### æµ‹è¯•é…ç½®
- **äº¤æ˜“å¯¹**: DOGE/USDT
- **æ—¶é—´å‘¨æœŸ**: 15åˆ†é’ŸKçº¿
- **æ•°æ®é‡**: 1000æ ¹Kçº¿ï¼ˆçº¦10å¤©ï¼‰
- **åˆå§‹èµ„é‡‘**: 1000 USDT
- **æ æ†å€æ•°**: 5x

### æ ¸å¿ƒæ•°æ®

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ€»äº¤æ˜“æ¬¡æ•° | **19** |
| ç›ˆåˆ©äº¤æ˜“ | 8æ¬¡ |
| äºæŸäº¤æ˜“ | 11æ¬¡ |
| èƒœç‡ | 42.11% |
| ç›ˆäºæ¯” | 1.87 |
| æ€»ç›ˆåˆ© | +126.65 USDT |
| æ€»äºæŸ | -93.37 USDT |
| å‡€æ”¶ç›Š | -228.99 USDT (-22.90%) |
| æœ€å¤§å•ç¬”ç›ˆåˆ© | +18.91 USDT (+7.32%) |
| æœ€å¤§å•ç¬”äºæŸ | -11.53 USDT (-4.43%) |

### å–å‡ºä¿¡å·åˆ†å¸ƒ

| å–å‡ºåŸå›  | è§¦å‘æ¬¡æ•° | å æ¯” |
|---------|---------|------|
| ğŸ›‘ æ­¢æŸ (-3%) | 30æ¬¡ | 58% |
| ğŸ¯ æ­¢ç›ˆ (+6%) | 21æ¬¡ | 41% |
| â° æ—¶é—´æ­¢æŸ | 0æ¬¡ | 0% |
| ğŸ“‰ AIçœ‹è·Œ | 0æ¬¡ | 0% |

---

## ğŸ’¡ å…³é”®å‘ç°

### âœ… æˆåŠŸä¹‹å¤„

1. **ç³»ç»Ÿæ¶æ„å®Œå–„**: 
   - ä¹°å…¥â†’æŒä»“â†’å–å‡ºçš„å®Œæ•´å¾ªç¯å·²å®ç°
   - æŒä»“çŠ¶æ€è·Ÿè¸ªå‡†ç¡®æ— è¯¯
   - TradingEngineä¸AISignalCoreçš„çŠ¶æ€åŒæ­¥æ­£å¸¸

2. **é£é™©æ§åˆ¶æœ‰æ•ˆ**:
   - æ­¢ç›ˆæ­¢æŸæœºåˆ¶æ­£å¸¸è§¦å‘
   - å•ç¬”æœ€å¤§äºæŸæ§åˆ¶åœ¨-4.43%
   - ç›ˆäºæ¯”è¾¾åˆ°1.87ï¼ˆä¼˜ç§€æ°´å¹³ï¼‰

3. **ä»£ç è´¨é‡é«˜**:
   - æ¨¡å—åŒ–è®¾è®¡æ¸…æ™°
   - æ—¥å¿—è®°å½•è¯¦ç»†
   - æ˜“äºè°ƒè¯•å’Œæ‰©å±•

### âš ï¸ éœ€è¦æ”¹è¿›

1. **èƒœç‡åä½**: 
   - å½“å‰42.11%ï¼Œä½äº50%
   - è¯´æ˜ä¹°å…¥æ—¶æœºé€‰æ‹©ä¸å¤Ÿç²¾å‡†
   - éœ€è¦æé«˜ä¹°å…¥é˜ˆå€¼æˆ–å¢åŠ è¿‡æ»¤æ¡ä»¶

2. **æ­¢æŸè§¦å‘è¿‡å¤š**:
   - 30æ¬¡æ­¢æŸ vs 21æ¬¡æ­¢ç›ˆ
   - è¯´æ˜ä¹°å…¥åä»·æ ¼ç»å¸¸ä¸‹è·Œ
   - å¯èƒ½éœ€è¦å¢åŠ è¶‹åŠ¿ç¡®è®¤

3. **AIä¿¡å·è´¨é‡**:
   - p_emaå€¼é›†ä¸­åœ¨0.4-0.7
   - ç¼ºä¹æ˜ç¡®çš„çœ‹è·Œä¿¡å·
   - å¯èƒ½éœ€è¦é‡æ–°è®­ç»ƒæ¨¡å‹æˆ–è°ƒæ•´ç‰¹å¾

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### ä¼˜å…ˆçº§1: æé«˜ä¹°å…¥è´¨é‡ â­â­â­
**ç›®æ ‡**: å°†èƒœç‡ä»42%æå‡åˆ°55%+

**å…·ä½“æªæ–½**:
1. æé«˜ä¹°å…¥é˜ˆå€¼: `CONFIDENCE_THRESHOLD: 0.30 â†’ 0.50`
2. å¢åŠ è¶‹åŠ¿è¿‡æ»¤: åªåœ¨ä»·æ ¼ > MA20æ—¶ä¹°å…¥
3. å¢åŠ åŠ¨é‡ç¡®è®¤: è¦æ±‚RSI > 50
4. å‡å°‘äº¤æ˜“é¢‘ç‡: é¿å…éœ‡è¡å¸‚äº¤æ˜“

**é¢„æœŸæ•ˆæœ**: èƒœç‡æå‡è‡³55-60%ï¼Œäº¤æ˜“æ¬¡æ•°å‡å°‘è‡³10-15æ¬¡

### ä¼˜å…ˆçº§2: ä¼˜åŒ–æ­¢ç›ˆæ­¢æŸå‚æ•° â­â­
**ç›®æ ‡**: å¹³è¡¡èƒœç‡å’Œç›ˆäºæ¯”

**æ–¹æ¡ˆAï¼ˆæé«˜èƒœç‡ï¼‰**:
- æ­¢ç›ˆ: 6% â†’ 5%
- æ­¢æŸ: -3% â†’ -2%

**æ–¹æ¡ˆBï¼ˆä¿æŒç›ˆäºæ¯”ï¼‰**:
- æ­¢ç›ˆ: 6% â†’ 8%
- æ­¢æŸ: -3% â†’ -4%

**æ–¹æ¡ˆCï¼ˆç§»åŠ¨æ­¢æŸï¼‰**:
- ç›ˆåˆ©è¾¾åˆ°3%åï¼Œå°†æ­¢æŸç§»è‡³æˆæœ¬ä»·

### ä¼˜å…ˆçº§3: å¢åŠ å¸‚åœºç¯å¢ƒåˆ¤æ–­ â­
**ç›®æ ‡**: è¯†åˆ«è¶‹åŠ¿å¸‚å’Œéœ‡è¡å¸‚

**å…·ä½“æªæ–½**:
1. è®¡ç®—ATR: æ³¢åŠ¨ç‡é«˜æ—¶æ‰©å¤§æ­¢æŸ
2. ä½¿ç”¨ADX: åªåœ¨è¶‹åŠ¿æ˜ç¡®æ—¶äº¤æ˜“
3. è¯†åˆ«æ¨ªç›˜: æš‚åœäº¤æ˜“

### ä¼˜å…ˆçº§4: è¿è¡Œé•¿å‘¨æœŸå›æµ‹ â­
**ç›®æ ‡**: éªŒè¯ç­–ç•¥ç¨³å®šæ€§

**å…·ä½“æªæ–½**:
1. è¿è¡Œ5000-10000æ ¹Kçº¿å›æµ‹
2. æµ‹è¯•ä¸åŒå¸‚åœºç¯å¢ƒï¼ˆä¸Šæ¶¨/ä¸‹è·Œ/éœ‡è¡ï¼‰
3. å¯¹æ¯”ä¸åŒå‚æ•°ç»„åˆ

---

## ğŸ“¦ äº¤ä»˜ç‰©æ¸…å•

### ä»£ç æ–‡ä»¶
- âœ… `butterfly_bot/strategies/ai_signal_core.py` (å·²ä¿®æ”¹)
- âœ… `butterfly_bot/core/engine/trading_engine.py` (å·²ä¿®æ”¹)
- âœ… `scripts/test_backtest.py` (å·²ä¿®æ”¹)

### æ–‡æ¡£æ–‡ä»¶
- âœ… `BACKTEST_RESULTS_ANALYSIS.md` (æ–°å¢)
- âœ… `DELIVERY_SUMMARY.md` (æœ¬æ–‡ä»¶)

### å›æµ‹æŠ¥å‘Š
- âœ… `reports/backtest/backtest_SPOT_leverage1_20251223_222127.json`
- âœ… `reports/backtest/backtest_USDT_M_leverage3_20251223_222200.json`
- âœ… `reports/backtest/backtest_USDT_M_leverage5_20251223_222234.json`

### GitHubæäº¤
- âœ… Commit: 99499ba
- âœ… æ¨é€åˆ°masteråˆ†æ”¯
- âœ… åŒ…å«è¯¦ç»†çš„commit message

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **GitHubä»“åº“**: https://github.com/yanzhao77/ButterflyBot
- **æœ€æ–°æäº¤**: https://github.com/yanzhao77/ButterflyBot/commit/99499ba
- **å›æµ‹æŠ¥å‘Š**: `/reports/backtest/backtest_USDT_M_leverage5_20251223_222234.json`
- **è¯¦ç»†åˆ†æ**: `BACKTEST_RESULTS_ANALYSIS.md`

---

## ğŸ“ˆ é¢„æœŸæ”¹è¿›è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼ˆå½“å‰ï¼‰âœ…
- [x] å®ç°æŒä»“çŠ¶æ€è·Ÿè¸ª
- [x] å®ç°æ­¢ç›ˆæ­¢æŸæœºåˆ¶
- [x] äº§ç”Ÿå®Œæ•´ä¹°å–å¾ªç¯
- [x] ç³»ç»Ÿå¯è¯„ä¼°

### ç¬¬äºŒé˜¶æ®µï¼ˆä¸‹ä¸€æ­¥ï¼‰
- [ ] æé«˜ä¹°å…¥é˜ˆå€¼åˆ°0.50
- [ ] å¢åŠ è¶‹åŠ¿è¿‡æ»¤
- [ ] è¿è¡Œé•¿å‘¨æœŸå›æµ‹
- [ ] ä¼˜åŒ–æ­¢ç›ˆæ­¢æŸå‚æ•°

### ç¬¬ä¸‰é˜¶æ®µï¼ˆæœªæ¥ï¼‰
- [ ] å¢åŠ å¸‚åœºç¯å¢ƒåˆ¤æ–­
- [ ] å®ç°ç§»åŠ¨æ­¢æŸ
- [ ] ä¼˜åŒ–AIæ¨¡å‹
- [ ] å®ç°å‚æ•°è‡ªåŠ¨ä¼˜åŒ–

### æœ€ç»ˆç›®æ ‡
- [ ] èƒœç‡ > 55%
- [ ] ç›ˆäºæ¯” > 1.5
- [ ] æœˆæ”¶ç›Šç‡ > 10%
- [ ] æœ€å¤§å›æ’¤ < 15%

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä»»åŠ¡**åœ†æ»¡å®Œæˆ**ï¼

**æ ¸å¿ƒçªç ´**:
- âœ… ä»0äº¤æ˜“åˆ°19äº¤æ˜“ï¼Œç³»ç»Ÿå·²èƒ½æ­£å¸¸è¿è¡Œ
- âœ… æ­¢ç›ˆæ­¢æŸæœºåˆ¶å·¥ä½œæ­£å¸¸
- âœ… ä»£ç æ¶æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•

**ä¸‹ä¸€æ­¥é‡ç‚¹**:
- ğŸ¯ ä¼˜åŒ–ä¹°å…¥æ—¶æœºï¼Œæé«˜èƒœç‡
- ğŸ¯ è¿è¡Œé•¿å‘¨æœŸå›æµ‹ï¼ŒéªŒè¯ç¨³å®šæ€§
- ğŸ¯ å‚æ•°è°ƒä¼˜ï¼Œè¿½æ±‚ç›ˆåˆ©

**æŠ€æœ¯å€ºåŠ¡**:
- æ— ä¸¥é‡æŠ€æœ¯å€ºåŠ¡
- ä»£ç è´¨é‡è‰¯å¥½
- æ–‡æ¡£å®Œæ•´

---

*äº¤ä»˜æ—¶é—´: 2025-12-23*  
*ä»»åŠ¡çŠ¶æ€: âœ… å®Œæˆ*  
*ä¸‹ä¸€æ­¥: å‚æ•°ä¼˜åŒ–å’Œé•¿å‘¨æœŸå›æµ‹*
