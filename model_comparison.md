# 模型性能对比分析

## 训练结果对比

| 指标 | 优化前（v20251217_211014） | 优化后（v20251222_031926） | 变化 |
|------|---------------------------|---------------------------|------|
| **目标变量** | | | |
| TARGET_THRESHOLD | 1.5% | **0.5%** | -67% |
| TARGET_SHIFT | 4根K线 | **2根K线** | -50% |
| **类别分布** | | | |
| 正样本比例 | 2.85% | **11.26%** | +295% ✅ |
| 训练样本数 | 3395 | 3395 | 不变 |
| **模型性能** | | | |
| AUC | 0.8512 | **0.7383** | -13% |
| 准确率 | 99% | **85%** | -14% |
| **正类预测** | | | |
| Precision（上涨） | 0% | **19%** | +19% ✅ |
| Recall（上涨） | 0% | **43%** | +43% ✅ |
| F1-score（上涨） | 0% | **26%** | +26% ✅ |
| **负类预测** | | | |
| Precision（下跌） | 99% | **96%** | -3% |
| Recall（下跌） | 100% | **88%** | -12% |
| F1-score（下跌） | 99% | **92%** | -7% |
| **类别权重** | | | |
| 正样本权重 | 1.0 | **3.71** | +271% |
| 负样本权重 | 1.0 | **0.58** | -42% |

## 关键发现

### ✅ 重大改进

1. **正样本比例提升**
   - 从2.85%提升到11.26%
   - 增加了近4倍的正样本
   - 模型有足够的"上涨"样本来学习

2. **模型能预测上涨了**
   - Recall从0%提升到43%
   - 意味着模型能识别43%的上涨机会
   - 这是最关键的改进！

3. **类别权重生效**
   - 正样本权重3.71，负样本权重0.58
   - 模型更关注少数类（上涨）
   - 平衡了类别不平衡问题

### ⚠️ 可接受的妥协

1. **AUC下降**
   - 从0.8512降到0.7383
   - 这是正常的，因为我们牺牲了一些整体准确率
   - 换取了更平衡的预测能力

2. **准确率下降**
   - 从99%降到85%
   - 但这个99%是"虚假的高准确率"（只预测下跌）
   - 85%是更真实的准确率

3. **负类性能略降**
   - Recall从100%降到88%
   - 但仍然很高，可以接受

## 预测分布分析

### 优化前模型
```
预测结果分布：
- 预测下跌：1455个（100%）
- 预测上涨：0个（0%）

实际标签分布：
- 实际下跌：1438个
- 实际上涨：17个
```

**问题**：模型学会了"永远预测下跌"，对交易毫无用处。

### 优化后模型
```
预测结果分布（估算）：
- 预测下跌：约1200个（82%）
- 预测上涨：约255个（18%）

实际标签分布：
- 实际下跌：1367个
- 实际上涨：88个

正确预测：
- 正确预测下跌：1203个（88% recall）
- 正确预测上涨：38个（43% recall）
```

**改进**：模型现在会预测"上涨"，并且能识别43%的上涨机会！

## 对交易策略的影响

### 优化前
- **买入信号**：几乎没有（模型不预测上涨）
- **交易次数**：0
- **策略状态**：完全失效

### 优化后（预期）
- **买入信号**：应该会产生（模型能预测上涨）
- **交易次数**：预计会有交易
- **策略状态**：应该能正常工作

## 下一步验证

需要通过回测验证以下问题：

1. **是否产生交易信号？**
   - 优化前：0笔交易
   - 优化后：预计会有交易

2. **交易表现如何？**
   - 收益率是否改善？
   - 最大回撤是否降低？
   - 夏普比率是否提升？

3. **信号质量如何？**
   - 43%的recall意味着能抓住43%的上涨机会
   - 19%的precision意味着5次买入信号中有1次是对的
   - 这个比例是否足够盈利？

## 结论

✅ **类别不平衡问题已解决**
- 正样本比例从2.85%提升到11.26%
- 模型现在能预测"上涨"（Recall 43%）

✅ **模型现在是平衡的**
- 不再"永远预测下跌"
- 对两个类别都有预测能力

⚠️ **需要回测验证**
- 虽然模型指标改善，但实际交易表现如何？
- 43%的recall和19%的precision能否盈利？
- 需要实际数据验证

## 技术细节

### 调整的参数

**config/settings.py**:
```python
TARGET_SHIFT = 2  # 从4降到2
TARGET_THRESHOLD = 0.005  # 从0.015降到0.005
```

**model/lgb_model.py**:
```python
def train(..., use_class_weight=False):
    if use_class_weight:
        sample_weight = compute_sample_weight('balanced', y_train)
        train_data = lgb.Dataset(X_train, label=y_train, weight=sample_weight)
```

**scripts/train_multi_symbol.py**:
```python
model.train(X_train, y_train, X_test, y_test, use_class_weight=True)
```

### 模型文件

- **优化前**：`models/registry/v20251217_211014.pkl`
- **优化后**：`models/registry/v20251222_031926.pkl`

---

**生成时间**: 2025-12-22  
**分析者**: ButterflyBot优化团队
